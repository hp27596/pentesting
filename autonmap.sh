#!/usr/bin/env bash

wlan=$(ip a | grep -m 1 wl | awk '{ print $2 }' | awk -F ":" '{ print $1 }')

echo "Network Interface Name: $wlan"

echo "Press 1 to run nmap scans on 0/24 range, 2 to run on 0/16 range, 3 to input target's IP manually"
read -n 1 -p "Selection: " range -r
echo

if [ "$range" = "1" ]; then
    iprange="$(ip a | grep $wlan | grep inet | awk '{ print $2 }'| awk -F '.' 'BEGIN{OFS=FS}; NF{--NF};1').0/24"
elif [ "$range" = "2" ]; then
    iprange="$(ip a | grep $wlan | grep inet | awk '{ print $2 }'| awk -F '.' 'BEGIN{OFS=FS}; NF{NF-=2};1').0/16"
elif [ "$range" = "3" ]; then
    iprange="$(ip a | grep $wlan | grep inet | awk '{ print $2 }'| awk -F '.' 'BEGIN{OFS=FS}; NF{NF-=2};1')"
    read -p "Target's IP: $iprange" address
    iprange=$iprange$address
fi

echo "Press 1 to run board ping scans (no port discovery)"
echo "Press 2 to search for vulnerable Windows SMB exploits"
echo "Press 3 to discover some popular ports, OS information and version detection"
echo "Press 4 to find all ports and information"
read -n 1 -p "Selection: " option -r
echo "Starting Nmap..."

if [ "$option" = "1" ]; then
    sudo nmap $iprange -T5 --min-parallelism 1000 -sn -n
elif [ "$option" = "2" ]; then
    sudo nmap $iprange -p 445 -T4 -O --min-parallelism 100 -sV -n
elif [ "$option" = "3" ]; then
    sudo nmap $iprange -p 21,22,23,80,443,445 -T5 -O --min-parallelism 100 -sV -n
elif [ "$option" = "4" ]; then
    sudo nmap $iprange -p- -T4 -A
fi




### To do: Rerun script
    # read -p "Do you want to continue scanning with more advanced options? (Y/n): " choice
    # if [ "${choice,,}" = "y" ]; then
    #     iprange="$(ip a | grep $wlan | grep inet | awk '{ print $2 }'| awk -F '.' 'BEGIN{OFS=FS}; NF{NF-=2};1')"
    #     read -p "Target's IP: $iprange" address
    #     iprange=$iprange$address
    # fi
